<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>loki on 馬丁沒有派對</title>
    <link>https://blog.ooopiz.com/tags/loki/</link>
    <description>Recent content in loki on 馬丁沒有派對</description>
    <image>
      <url>https://blog.ooopiz.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://blog.ooopiz.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Tue, 31 Oct 2023 17:37:01 +0800</lastBuildDate><atom:link href="https://blog.ooopiz.com/tags/loki/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Loki 使用 Ruler&#39;s Record Data 處理大量日誌統計</title>
      <link>https://blog.ooopiz.com/post/2023/10/loki-ruler-record-data/</link>
      <pubDate>Tue, 31 Oct 2023 17:37:01 +0800</pubDate>
      
      <guid>https://blog.ooopiz.com/post/2023/10/loki-ruler-record-data/</guid>
      <description>Loki 環境說明 Loki 使用 3台 Monolithic mode 的 cluster ring kvstore 使用 memberlist Storage 在 AWS S3 情境說明 目前使用 Loki 記錄 nginx 的訪問日誌， 日誌有點份量之後，Loki 原生的統計函數非常的吃緊，動不動就跑到 CPU 100% 然後 timeout
在官方文件上看到 record data 的做法。 基本上是利用 ruler 模組，定期執行統計，記錄到 prometheus 或其它支援的 storage，不用每次都跑一堆計算，可以改拉 prometheus 預算好的資料。
下圖取自 record data 後拉取的資料 (24小時有 272M筆記錄，284GB)
Ruler 如果 loki 是 cluster 必須啟用 rule api 來管理規則,不能將 ruler 存放在單台的 disk 上
loki 設定範例 common: ring: kvstore: store: memberlist memberlist: bind_port: 7946 join_members: - 127.</description>
    </item>
    
  </channel>
</rss>
